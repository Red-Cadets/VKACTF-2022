## Ð¡Ð°Ð³Ð° Ð¾ ÐšÐ¸Ð±ÐµÑ€ÑÐ»Ð°Ð²Ðµ. HTTP Ñ‡Ð°ÑÑ‚ÑŒ 2

| Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ | ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ | ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ | Ð¡Ð»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ |
| :------ | ---- | ---- | ---- |
| VKACTF 2022 | Ð¡Ð°Ð³Ð° Ð¾ ÐšÐ¸Ð±ÐµÑ€ÑÐ»Ð°Ð²Ðµ. HTTP Ñ‡Ð°ÑÑ‚ÑŒ 2 | Web | Easy |

### ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ

> ÐÐ²Ñ‚Ð¾Ñ€: [ ð•‚ð•£ð•’ð•¦ð•¤ð•– ]
>
> Ð’ ÑÐµÑ‚ÑŒ Ð±Ñ‹Ð»Ð¸ ÑÐ»Ð¸Ñ‚Ñ‹ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ ÐºÐ¾Ð´Ñ‹ ÑÐ°Ð¹Ñ‚Ð° ÐšÐ¸Ð±ÐµÑ€ÑÐ»Ð°Ð²Ð°. Ð£Ð·Ð½Ð°Ð¹Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð¾Ð½Ð¸ ÑÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‚!

### Ð£ÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚ÑŒ

> [Request Smuggling Via HTTP/2 Cleartext (h2c)](https://bishopfox.com/blog/h2c-smuggling-request)

### Ð ÐµÑˆÐµÐ½Ð¸Ðµ
![](images/main.jpg)

Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð» ÑÐ°Ð¹Ñ‚Ð° Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÐµÐ½. ÐÐ° Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÐºÐ°ÐºÐ¾Ðµ-Ð»Ð¸Ð±Ð¾ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼. ÐŸÐµÑ€ÐµÐ¹Ð´Ñ Ð¿Ð¾ Ð¿ÑƒÑ‚Ð¸ `/flag` Ð²ÐµÐ± Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð²Ñ‹Ð´Ð°Ñ‚ÑŒ Ñ„Ð»Ð°Ð³, Ð½Ð¾ Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€ `HAProxy` Ð·Ð°Ð¿Ñ€ÐµÑ‰Ð°ÐµÑ‚ Ð½Ð°Ð¼ ÑÑ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ, Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑ Ð»ÑŽÐ±Ð¾Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ð¾ Ð´Ð°Ð½Ð½Ð¾Ð¼Ñƒ Ð¿ÑƒÑ‚Ð¸.

![](images/403.jpg)

Ð’ ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ `Ð¡ÐµÑ‚ÑŒ` Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ð±Ñ‰Ð°ÐµÑ‚ÑÑ Ð¿Ð¾ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ñƒ `HTTP/2`

![](images/h2.jpg)

Ð£ÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð°ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€ `HAProxy` **Ð¿Ð¾-ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ** Ð¿ÐµÑ€ÐµÑÑ‹Ð»Ð°ÐµÑ‚ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ `Upgrade` Ð¸ `Connection`, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑÑ‚Ð¸ Ð°Ñ‚Ð°ÐºÑƒ `h2c Smuggling`

ÐÐ° github Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ [ÑÐºÑÐ¿Ð»Ð¾Ð¹Ñ‚](https://github.com/BishopFox/h2csmuggler/blob/master/h2csmuggler.py), Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÑŽÑ‰Ð¸Ð¹ Ð´Ð°Ð½Ð½ÑƒÑŽ Ð°Ñ‚Ð°ÐºÑƒ.

Ð­ÐºÑÐ»Ð¾Ð¹Ñ‚Ñƒ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ Ð°Ð´Ñ€ÐµÑ Ð¿Ñ€Ð¾ÐºÑÐ¸-ÑÐµÑ€Ð²ÐµÑ€Ð° Ð¸ Ð¿ÑƒÑ‚ÑŒ, Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ. Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐºÑÐ¿Ð»Ð¾Ð¹Ñ‚ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ„Ð»Ð°Ð¶Ð¾Ðº

```bash
python3 h2csmuggler.py -x https://PROXY http://127.0.0.1/flag
```

### ÐÐµÐ¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ

```
https://185.193.143.214//flag
```

**Ð¤Ð»Ð°Ð³:**

> vka{h2c_http_smuggling}
